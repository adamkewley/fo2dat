---

language: rust
rust:
  - 1.24.0

before_install:
- sudo apt-get install mingw-w64   # cross-compile Linux -> Windows
- mv cargo-config ~/.cargo/config  # linker+ar config for windows targets
- rustup target install x86_64-pc-windows-gnu
- rustup target install i686-pc-windows-gnu

script:
- cargo build --release --target x86_64-unknown-linux-gnu
- cargo build --release --target x86_64-pc-windows-gnu
- echo 'panic = "abort"' >> Cargo.toml  # HACK: due to win32 exceptions: see ./cargo-config
- cargo build --release --target i686-pc-windows-gnu

before_deploy:
- mv target/i686-pc-windows-gnu/release/fo2dat.exe target/i686-pc-windows-gnu/release/fo2dat-i686.exe

deploy:
  provider: releases
  on:
    tags: true
  api_key: XG8t2edBcg/NzcmOH0U+oNy7kfl1oc+iyObsuFpP9DkMzkZcNJYvbDga67EAyOD4cleYQdY+i6W0aOPcdZaHsP88ryP+GdxvQz7RoLvkMFkiefpHcZVW52Uvx2ZnaayannCuL44oB5G0s3KsaT4BwtjTXeq6dZmuZqBPR74j4psI2isl0nH7E9eaOkkxzJRQbHApf9pUpQka8zDdmt3ZaQpFePeBHyGxkC1fXFZkYzCPSRnk2yxQVr7nQHUbwBqVdf2GIVKwJfxIwdCTbmlYRDd4K/bG3dCY5a7mkxhXBOGYRzfwwNzTx61XwaxVqNZgFrXLiqX3dOwba618n3KPDJbAEkJ58t1cOANsMjahj+xiF+G77LR/Tro04+nWxTt7owchptkqwaoL7WnrgJ4EqmTEoob6B1QuiSCoKBvmDq+PfyWCtkQUXrSJ2wPpu8y54MeqINL4b9oHd/juNPDvLfcnceRdKoOP/qTNwzUa7QOpKj4waLvMhAqxW9nKHGSpm96TPyPXvYFwcrJrbfIhMHpUZNlgLlfql70QNWrASE4INO228Y0FeQN4ne7965u5vD7n/KcHvia8HkUeewtJ5XfEUkdd8yp2/JBbcK/2r5jCfwf0bJzgMRnrIuetYAAcxHry9vgOCWZ+NIdi+s4XjH6Mh6zJphOUrs9+dlUI0z0=
  skip_cleanup: true
  file:
  - target/x86_64-unknown-linux-gnu/release/fo2dat
  - target/x86_64-pc-windows-gnu/release/fo2dat.exe
  - target/i686-pc-windows-gnu/release/fo2dat-i686.exe
